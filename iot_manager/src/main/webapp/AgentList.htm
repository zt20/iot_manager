<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>代理商管理</title>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/plugins/select2/select2.css">
    <link rel="stylesheet" href="css/plugins/icheck/all.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/list.css">
    <link rel="stylesheet" href="css/pagination.css">
    <!--[if IE 7]>
    <link rel="stylesheet" href="css/font-awesome-ie7.min.css">
    <link rel="stylesheet" href="css/ie7.css">
    <![endif]-->
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/plugins/select2/select2.min.js"></script>
    <script type="text/javascript" src="js/plugins/icheck/jquery.icheck.min.js"></script>
    <script type="text/javascript" src="js/plugins/bootbox/jquery.bootbox.js"></script>
    <script type="text/javascript" src="js/init.js"></script>
    <script type="text/javascript" src="js/jquery.form.min.js"></script>
    <script type="text/javascript" src="js/plugins/jquery-paginator/jquery.pagination.js"></script>

    <!--[if lte IE 9]>
    <script src="js/plugins/placeholder/jquery.placeholder.min.js"></script>
    <script>
        $(document).ready(function () {
            $('input, textarea').placeholder();
        });
    </script>
    <![endif]-->
    <script type="text/javascript">
        // $(document).ready(function () {
        //     $(".action-discount").on("click", function () {
        //         var agentID = $(this).attr("data-id");
        //         var agentName = $(this).attr("data-name");
        //         $("#agentID").val(agentID);
        //         $("#chargeType").val(1);
        //         $("#myModalLabel2").html(agentName + "的流量折扣");
        //         $.ajax({
        //             url: 'GetAgentInterface.htm',
        //             type: 'POST',
        //             data: {action: "getList", "chargeType": "1", agentID: agentID},
        //             error: function () {
        //                 alert("远程访问失败");
        //             },
        //             success: function (result) {
        //                 var html = "";
        //                 for (var i = 0; i < result.Message.length; i++) {
        //                     html += "<div class=\"control-group\">";
        //                     html += "	<label for=\"account\" class=\"control-label\">" + result.Message[i].InterfaceName + "：</label>";
        //                     html += "	<div class=\"controls\">";
        //                     html += "		<input type=\"text\" name=\"discount" + result.Message[i].ID + "\" value=\"" + result.Message[i].Discount + "\" class=\"discountInput input-xlarge\" maxlength=\"5\" />";
        //                     html += "	</div>";
        //                     html += "</div>";
        //                 }
        //                 $("#bodyList").html(html);
        //                 $("#modal-plus").modal();
        //             }
        //         });
        //     });
        //
        //
        //     $(".action-tel-discount").on("click", function () {
        //         var agentID = $(this).attr("data-id");
        //         var agentName = $(this).attr("data-name");
        //         $("#agentID").val(agentID);
        //         $("#chargeType").val(2);
        //         $("#myModalLabel2").html(agentName + "的话费折扣");
        //         $.ajax({
        //             url: 'GetAgentInterface.htm',
        //             type: 'POST',
        //             data: {action: "getList", "chargeType": "2", agentID: agentID},
        //             error: function () {
        //                 alert("远程访问失败");
        //             },
        //             success: function (result) {
        //                 var html = "";
        //                 for (var i = 0; i < result.Message.length; i++) {
        //                     html += "<div class=\"control-group\">";
        //                     html += "	<label for=\"account\" class=\"control-label\">" + result.Message[i].InterfaceName + "：</label>";
        //                     html += "	<div class=\"controls\">";
        //                     html += "		<input type=\"text\" name=\"discount" + result.Message[i].ID + "\" value=\"" + result.Message[i].Discount + "\" class=\"discountInput input-xlarge\" maxlength=\"5\" />";
        //                     html += "	</div>";
        //                     html += "</div>";
        //                 }
        //                 $("#bodyList").html(html);
        //                 $("#modal-plus").modal();
        //             }
        //         });
        //     });
        //
        //     $(".goLogin").on("click", function () {
        //         var account = $(this).attr("data-account");
        //         var password = $(this).attr("data-password");
        //         location.href = "http://47.92.159.122:8084/LoginApi.htm?action=login&account=" + account + "&password=" + password;
        //     });
        //
        //     $("#modal-plus").on("click", ".btn-primary", function () {
        //         $("#most-plus-form").ajaxSubmit({
        //             type: "POST",
        //             success: function (result) {
        //                 //if (!result.OK)
        //                 alert(result.Message);
        //             },
        //             error: function (XmlHttpRequest, textStatus, errorThrown) {
        //                 alert("操作失败服务器错误");
        //             }
        //         });
        //         $("#bodyList").html("");
        //         $("#modal-plus").modal("hide");
        //     });

        //
        //     $(".btn-stop").on("click", function () {
        //         id = new Array();
        //         $(".table tbody").find("input[type='checkbox']:checked").each(function (i, item) {
        //             id[i] = item.value;
        //         });
        //         if (id == "") {
        //             alert("请至少选择一项！");
        //             return;
        //         }
        //         if (!confirm('你确定要进行该操作吗？')) {
        //             return;
        //         }
        //         location.href = "AgentList.htm?action=stopAll&ids=" + id;
        //     });
        //
        //     $(".btn-use").on("click", function () {
        //         id = new Array();
        //         $(".table tbody").find("input[type='checkbox']:checked").each(function (i, item) {
        //             id[i] = item.value;
        //         });
        //         if (id == "") {
        //             alert("请至少选择一项！");
        //             return;
        //         }
        //         if (!confirm('你确定要进行该操作吗？')) {
        //             return;
        //         }
        //         location.href = "AgentList.htm?action=useAll&ids=" + id;
        //     });
        // });
    </script>
</head>
<body>
<div class="container-fluid" id="content">
    <div id="main">
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span12">
                    <div class="box box-bordered">
                        <div class="box-title">
                            <h3><i class="icon-table"></i> 代理商列表</h3>
                            <a href="AgentAdd.htm" class="btn btn-primary" style="float:right;margin-right:10px;"><i
                                    class="icon-plus-sign"></i> 添加代理商</a>

                        </div>
                        <div class="box-content nopadding">
                            <div class="dataTables_wrapper">
                                <div class="dataTables_info1" style="padding-top: 10px;">
                                    <div class="dataTables_filter">
                                        <div class="form-inline">
                                            <label>代理账号: </label>
                                            <input type="text" class="input-small" name="account" id="account"
                                                   placeholder="代理账号" value=""/>
                                            <label>代理名称: </label>
                                            <input type="text" class="input-small" name="agentName" id="agentName"
                                                   placeholder="代理名称" value=""/>
                                            <label>代理编号: </label>
                                            <input type="text" class="input-small" name="agentID" id="searchagentID"
                                                   placeholder="代理编号" value=""/>
                                            <label>状态: </label>
                                            <select id="status" name="status" class="select2-me input-small"
                                                    data-search="false">
                                                <option value="">全部状态</option>
                                                <option value="0">启用</option>
                                                <option value="1">停用</option>
                                            </select>

                                            <button id="agentSearch" type="submit" class="btn btn-primary"><i
                                                    class="icon-search"></i> 搜索
                                            </button>

                                            <button type="button" id="agentStop" class="btn btn-primary btn-stop"><i
                                                    class="icon-trash"></i> 停用
                                            </button>
                                            <button type="button" id="agentStart" class="btn btn-primary btn-use"><i
                                                    class="icon-ok"></i> 启用
                                            </button>

                                        </div>
                                    </div>
                                </div>
                                <div style="clear:both;"></div>
                                <table id="agentList"
                                       class="table table-hover table-nomargin table-bordered table-condensed">
                                    <thead>
                                    <tr>
                                        <th><input type="checkbox" class="check-all" name="chkAll" value="0"/></th>
                                        <th style="width:50px;">编号</th>
                                        <th>登录帐号</th>
                                        <th style="width:auto;">代理名称</th>

                                        <!--<th style="width:40px;">OEM</th>-->

                                        <th style="width:auto;">物联网余额</th>
                                        <th style="width:auto;">返佣模式</th>

                                        <th style="width:auto;">创建时间</th>
                                        <th style="width:auto;">状态</th>

                                        <!--<th style="width:40px;">跳转</th>-->

                                        <th sstyle="width:auto;">操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                </table>
                                <div id="pagination-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!--<div id="modal-plus" class="modal hide fade" role="dialog" aria-labelledby="myModalLabel2"-->
<!--aria-hidden="true">-->
<!--<form id="most-plus-form" class="form-horizontal" novalidate="novalidate" action="GetAgentInterface.htm">-->
<!--<input type="hidden" name="action" value="saveDiscount"/>-->
<!--<input type="hidden" name="agentID" id="agentID" value=""/>-->
<!--<input type="hidden" name="chargeType" id="chargeType" value="1"/>-->
<!--<div class="modal-header">-->
<!--<button type="button" class="close btn btn-mini" data-dismiss="modal" aria-hidden="true">-->
<!--×-->
<!--</button>-->
<!--<h4 class="modal-title" id="myModalLabel2">-->
<!--代理折扣</h4>-->
<!--</div>-->
<!--<div class="modal-body">-->
<!--<div class="box-content" id="bodyList">-->
<!--</div>-->
<!--</div>-->
<!--<div class="modal-footer">-->
<!--<a class="btn" data-dismiss="modal" aria-hidden="true">关闭</a> <a class="btn btn-primary">确定</a>-->
<!--</div>-->
<!--</form>-->
<!--</div>-->
</body>


<script>
    $("#agentSearch").click(function () {
        pageStart();

        function pageStart() {
            var agentAccount = $("#account").val();
            var name = $("#agentName").val();
            var id = $("#searchagentID").val();
            var status = $("#status").val();
            // console.log(agentAccount + ";" + name +";" + id + ";" + status)
            $('#pagination-container').pagination({
                dataSource: '/api/v1/agent_list.do?agentAccount='
                    + agentAccount + "&name=" + name + "&id=" + id
                    + "&status=" + status,
                prevText: '<<',
                nextText: '>>',
                goButtonText: 'go',
                alias: {
                    pageNumber: 'page',
                    pageSize: 'size'
                },
                pageSize: 15,
                totalNumberLocator: function (response) {//处理页数
                    return response.total;
                },
                locator: 'list',
                ajax: {
                    type: 'GET',
                    beforeSend: function () {//请求前处理
                        $("#dataContainer").html('加载中...');
                    }
                },
                showGoInput: true,
                showGoButton: true,
                showNavigator: true,
                callback: function (data, pagination) {
                    $("#agentList tr td").remove();
                    $.each(data, function (i, item) {
                        var result = "<tr><td><input type='checkbox' name = 'id' value=" + item['id'] + "</td><td>"
                            + item['id'] + "</td><td>" + item['agentAccount'] + "</td><td>" + item['name'] + "</td><td>"
                            + fix(item['balance']) + "</td><td>" + billingMode(item['billingMode']) + "</td><td>" + item['addTime']
                            + "</td><td>" + agentStatus(item['status']) + "</td><td><a href=\"/AgentEdit.htm?" + item['id']
                            + "\">修改</a>&#12288<a href= \"/M2MAgentBalanceChangeAdd.htm?" + item['id'] + "\">物联网充/扣值</a>"
                            + "&#12288<a href='javascript:void(0)' onclick=\"deleteAgent('" + item['id'] + "')\">删除</a></td>";
                        $("#agentList").append(result);
                    });
                }

            });
        }

    });


    function agentStatus(data) {
        if (data == 0)
            return "<span class='label label-success'>启用</span>";
        return "<span class='label label-important'>停用</span>";
    }

    function billingMode(data) {
        if (data == 0)
            return "返佣";
        return "预存";
    }

    deleteAgent = function (data) {
        if (confirm('你确定要删除吗？')) {
            $.ajax({
                type: 'delete',
                url: '/api/v1/agent_delete.do',
                data: {id: data},
                success: function (data) {
                    if (data.code == 0) {
                        alert("删除成功");
                        window.location.reload();
                    } else {
                        alert(data.msg);
                    }
                },
                error: function (XMLHttpRequest) {
                    alert("系统出错了" + XMLHttpRequest.status);
                },
            });
        }
    }

    $(document).ready(function () {
        $('#pagination-container').pagination({
            dataSource: '/api/v1/agent_list.do?',
            prevText: '<<',
            nextText: '>>',
            goButtonText: 'go',
            alias: {
                pageNumber: 'page',
                pageSize: 'size'
            },
            pageSize: 10,
            totalNumberLocator: function (response) {//处理页数
                return response.total;
            },
            locator: 'list',
            ajax: {
                type: 'GET',
                beforeSend: function () {//请求前处理
                    $("#dataContainer").html('加载中...');
                }
            },
            showGoInput: true,
            showGoButton: true,
            showNavigator: true,
            callback: function (data, pagination) {
                $("#agentList tr td").remove();
                $.each(data, function (i, item) {
                    var result = "<tr><td><input type='checkbox' name = 'id' value='" + item['id'] + "'/></td><td>"
                        + item['id'] + "</td><td>" + item['agentAccount'] + "</td><td>" + item['name'] + "</td><td>"
                        + fix(item['balance']) + "</td><td>" + billingMode(item['billingMode']) + "</td><td>" + item['addTime']
                        + "</td><td>" + agentStatus(item['status']) + "</td><td><a href=\"/AgentEdit.htm?" + item['id']
                        + "\">修改</a>&#12288<a href= \"/M2MAgentBalanceChangeAdd.htm?" + item['id'] + "\">物联网充/扣值</a>"
                        + "&#12288<a href='javascript:void(0)' onclick=\"deleteAgent('" + item['id'] + "')\">删除</a></td>";
                    $("#agentList").append(result);
                });
            }

        });
    });

    function fix(data) {
        if (data == null)
            return 0.0000;
        return data.toFixed(4);
    }


    // $("#agentStop").click(function () {
    //     var checked = [];
    //     $('input:checkbox:checked').each(function() {
    //         checked.push($(this).val());
    //     });
    //     alert(checked);
    // });

    $(".btn-stop").on("click", function () {
        var id = new Array();
        $(".table tbody").find("input[type='checkbox']:checked").each(function (i, item) {
            id[i] = item.value;
        });
        console.log(id);
        if (id == "") {
            alert("请至少选择一项！");
            return;
        }
        if (!confirm('你确定要进行该操作吗？')) {
            return;
        }

        $.ajax({
            type: 'POST',
            url: '/api/v1/agent_updateStatus.do',
            data: {ids: id, action: 'stop'},
            success: function (data) {
                if (data.code == 0) {
                    alert("更新成功");
                    window.location.reload();
                } else {
                    alert(data.msg);
                }
            },
            error: function (XMLHttpRequest) {
                alert("系统出错了" + XMLHttpRequest.status);
            },
        });
    });


    $(".btn-use").on("click", function () {
        var id = new Array();
        $(".table tbody").find("input[type='checkbox']:checked").each(function (i, item) {
            id[i] = item.value;
        });
        console.log(id);
        if (id == "") {
            alert("请至少选择一项！");
            return;
        }
        if (!confirm('你确定要进行该操作吗？')) {
            return;
        }

        $.ajax({
            type: 'POST',
            url: '/api/v1/agent_updateStatus.do',
            data: {ids: id, action: 'ok'},
            success: function (data) {
                if (data.code == 0) {
                    alert("更新成功");
                    window.location.reload();
                } else {
                    alert(data.msg);
                }
            },
            error: function (XMLHttpRequest) {
                alert("系统出错了" + XMLHttpRequest.status);
            },
        });
    });

</script>
</html>
